# users Table

**Type:** Core Authentication  
**Tenant Isolation:** N/A (users exist across all organizations)

---

## üìã Schema

```sql
CREATE TABLE users (
  id            VARCHAR(36) PRIMARY KEY,        -- UUID
  email         VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  display_name  VARCHAR(100) NOT NULL,
  avatar_url    VARCHAR(500),
  details       JSON,                           -- Profile info, preferences, social links
  status        ENUM('active', 'inactive', 'suspended') DEFAULT 'active',
  created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

---

## üîë Indexes

```sql
-- Primary key index (automatic)
PRIMARY KEY (id)

-- Unique email index (automatic from UNIQUE constraint)
UNIQUE KEY unique_email (email)

-- Performance index for login queries
CREATE INDEX idx_users_email_status ON users(email, status);
```

---

## üîí Security Notes

### Password Storage
- ‚ùå **NEVER store plain text passwords**
- ‚úÖ **ALWAYS use bcrypt** with 10+ rounds
- ‚úÖ **NEVER log password_hash**

### Email Privacy
- Consider encrypting email at rest (optional for v1)
- Never expose email in public APIs without auth

---

## üìù Fields Explanation

| Field | Type | Description | Required | Notes |
|-------|------|-------------|----------|-------|
| `id` | UUID | Primary key | ‚úÖ | Generated by backend |
| `email` | VARCHAR(255) | Login email | ‚úÖ | Unique, case-insensitive |
| `password_hash` | VARCHAR(255) | bcrypt hash | ‚úÖ | Never return in API |
| `display_name` | VARCHAR(100) | Name shown on UI | ‚úÖ |
| `avatar_url` | VARCHAR(500) | Profile image URL | ‚ùå |
| `details` | JSON | Flexible profile metadata | ‚ùå |
| `status` | ENUM | User account state | ‚úÖ |

### details JSON Structure (V√≠ d·ª•)
D√πng ƒë·ªÉ l∆∞u c√°c th√¥ng tin ph·ª• h·ªØu √≠ch m√† kh√¥ng c·∫ßn ƒë·ªïi schema:
```json
{
  "preferences": {
    "theme": "dark",
    "language": "vi"
  },
  "social": {
    "linkedin": "...",
    "github": "..."
  },
  "bio": "I am a fullstack developer...",
  "onboarding_completed": true
}
```
| `status` | ENUM | Account status | ‚úÖ | active, inactive, suspended |
| `created_at` | TIMESTAMP | Account creation | ‚úÖ | Auto-generated |
| `updated_at` | TIMESTAMP | Last update | ‚úÖ | Auto-updated |

---

## üîó Relationships

### Has Many
- **members** - User can be member of multiple organizations
- **chats** - User can have multiple chat sessions
- **tasks** - User can be assigned to tasks

### Referenced By
- `created_by` in projects, issues, documents, etc.
- `assignee_id` in issues, tasks
- `reporter_id` in issues

---

## üéØ Common Queries

### Find user by email (login)

```typescript
const user = await User.findOne({
  where: { 
    email: email.toLowerCase(), // Case-insensitive
    status: 'active'
  }
});
```

### Get user with organizations

```typescript
const user = await User.findByPk(userId, {
  include: [{
    model: Member,
    as: 'memberships',
    where: { status: 'active' },
    include: [{
      model: Organization,
      as: 'organization'
    }]
  }]
});
```

---

## ‚úÖ Validation Rules

### Email
- Format: valid email regex
- Unique: case-insensitive
- Max length: 255 characters

### Password (before hashing)
- Min length: 8 characters
- Must contain: uppercase, lowercase, numbers
- Optional: special characters

### Display Name
- Min length: 1 character
- Max length: 100 characters
- No XSS: sanitize before saving

---

## üß™ Seeder Example

```typescript
// seeders/20260211-demo-users.ts
export async function up(queryInterface: QueryInterface) {
  const users = [
    {
      id: uuidv4(),
      email: 'admin@workflowhub.dev',
      password_hash: await bcrypt.hash('Admin123!', 10),
      display_name: 'Admin User',
      status: 'active',
      created_at: new Date(),
      updated_at: new Date(),
    },
    {
      id: uuidv4(),
      email: 'demo@workflowhub.dev',
      password_hash: await bcrypt.hash('Demo123!', 10),
      display_name: 'Demo User',
      status: 'active',
      created_at: new Date(),
      updated_at: new Date(),
    },
  ];
  
  await queryInterface.bulkInsert('users', users);
}
```

---

## üìö Related Documents

- [../v1-database-security.md](../v1-database-security.md) - Password security
- [../../backend/02-authentication.md](../../backend/02-authentication.md) - Auth implementation
- [organizations.md](organizations.md) - Organization membership
- [members.md](members.md) - User-org relationships

---

*Table Version: 1.0*  
*Last Updated: 2026-02-11*
