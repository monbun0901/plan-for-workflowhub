# users Table

**Type:** Core Authentication  
**Tenant Isolation:** N/A (Single-Tenant environment)

---

## üìã Schema

```sql
CREATE TABLE users (
  id            VARCHAR(36) PRIMARY KEY,        -- UUID
  email         VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  display_name  VARCHAR(100) NOT NULL,
  
  -- Access Control
  role_id       VARCHAR(36) NOT NULL REFERENCES roles(id),
  
  avatar_url    VARCHAR(500),
  details       JSON,                           -- Profile info, preferences, social links
  status        ENUM('active', 'inactive', 'suspended') DEFAULT 'active',
  
  created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

---

## üîë Indexes

```sql
-- Primary key index (automatic)
PRIMARY KEY (id)

-- Unique email index (automatic from UNIQUE constraint)
UNIQUE KEY unique_email (email)

-- Performance index for login queries
CREATE INDEX idx_users_email_status ON users(email, status);
CREATE INDEX idx_users_role ON users(role_id);
```

---

## üîí Security Notes

### Password Storage
- ‚ùå **NEVER store plain text passwords**
- ‚úÖ **ALWAYS use bcrypt** with 10+ rounds
- ‚úÖ **NEVER log password_hash**

---

## üìù Fields Explanation

| Field | Type | Description | Required | Notes |
|-------|------|-------------|----------|-------|
| `id` | UUID | Primary key | ‚úÖ | Generated by backend |
| `email` | VARCHAR(255) | Login email | ‚úÖ | Unique, case-insensitive |
| `password_hash` | VARCHAR(255) | bcrypt hash | ‚úÖ | Never return in API |
| `display_name` | VARCHAR(100) | Name shown on UI | ‚úÖ | |
| `role_id` | UUID | Link to Global Role | ‚úÖ | Defines system permissions |
| `avatar_url` | VARCHAR(500) | Profile image URL | ‚ùå | |
| `details` | JSON | Flexible profile metadata | ‚ùå | |
| `status` | ENUM | User account state | ‚úÖ | active, inactive, suspended |

---

## üîó Relationships

### Belongs To
- **roles** - M·ªói user c√≥ 1 vai tr√≤ h·ªá th·ªëng duy nh·∫•t.

### Has Many
- **chats** - User c√≥ th·ªÉ c√≥ nhi·ªÅu phi√™n chat
- **tasks** (as assignee) - User ƒë∆∞·ª£c giao nhi·ªÅu task
- **projects** (as creator) - User t·∫°o c√°c project

---

## üéØ Common Queries

### Find user with Role (login)

```typescript
const user = await User.findOne({
  where: { 
    email: email.toLowerCase(),
    status: 'active'
  },
  include: [{ model: Role, as: 'role' }]
});
```

---

*Last Updated: 2026-02-15*
